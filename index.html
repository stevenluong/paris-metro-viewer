<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Paris Metro Viewer</title>
        <script src="raphael-min.js"></script>
        <style media="screen">
            body {
                margin: 0;
                padding: 0;
                text-align: center;
            }
            #canvas {
                text-align: center;
            }
        </style>
				<script>
						var paper;
						var line3color = "#9C9933";
						window.onload = function () {
						  paper = Raphael("canvas", "800", "400");
							paper.clear();
							//background
							paper.rect(0, 0, "800", "400", 10).attr({fill: "#ccc", stroke: "none"});
							load(paper);	
							var line3 = new Line("#9C9933");
							line3.addStation(new Station(50,200,"Louise Michel"));
							line3.addStation(new Station(400,200,"Porte de Champeret"));
							line3.addStation(new Station(750,200,"Pereire"));
							line3.addTrain(new Train(line3.stations[0],true));
							updateTrains();		
							//TIME
							updateTime();
						};
						//Loader
						function load(paper){
							
						}
						//line 
						function Line(color){
							this.stations = new Array();
							this.trains = new Array();
							this.addStation = function(station){
								if(this.stations.length==0){
									station.isStart=true;
									station.isEnd=true;
									station.prev=null;
									station.next=null;
								}
								else{
									var lastStation = this.stations[this.stations.length-1];
									lastStation.next=station;
									lastStation.isEnd=false;
									station.prev=lastStation;
									station.isEnd=true;
									paper.path("M"+lastStation.x+","+lastStation.y+"L"+station.x+","+station.y).attr({stroke:color,"stroke-width":4});
								}
								this.stations.push(station);
							}
							this.addTrain = function(train){
								this.trains.push(train);
								console.log("train added ("+this.trains.length+")");
							}
						}
						//train
						function Train(station,positiveDirection)
						{
							var width = 20;
							var length = 30;
							this.drawing = paper.rect(station.x-length/2,station.y-width/2,length,width)
							.attr({fill:"black"});
							this.currentStation=station;
							this.positiveDirection=positiveDirection;
							if(positiveDirection){
								this.nextStation=station.next;
							}
							else{
								this.nextStation=station.prev;
							}
						}
						setInterval(function(){updateTrains()},1000);
						function updateTrains()
						{

							//console.log(train.drawing.x+":"+train.drawing.y);
							/*
							var nextStationIndex;
							if(train.positiveDirection){
								nextStationIndex = train.currentStationIndex+1;
							}
							else{
								nextStationIndex = train.currentStationIndex-1;
							}
							if(nextStationIndex>=stations.length||nextStationIndex<0)
							{
								//Change direction
								train.positiveDirection = !train.positiveDirection;
								if(nextStationIndex>=stations.length){
									nextStationIndex = nextStationIndex-2;
								}
								if(nextStationIndex<0){
									nextStationIndex = nextStationIndex+2
								}

							}

							
							var xDestination = stations[nextStationIndex].x;
							var animation = Raphael.animation({x:xDestination-trainLength/2},5000, "<>");
							train.drawing.stop();
							train.drawing.animate(animation);
							if(train.positiveDirection){
								train.currentStationIndex++;
							}
							else{
								train.currentStationIndex--;
							}*/
						}
						//Station
						function Station(x,y,name,color)
						{
							this.x = x;
							this.y = y;
							this.name = name;
							var nameDrawing = paper.text(x,y-30,name);

							var drawing = paper.circle(x,y,20).attr({stroke:line3color,fill:line3color});
							drawing.hover(
							function(){
								drawing.attr({fill:"#fff"});
							},
							function(){
								drawing.attr({fill:line3color});
							});
						}
						//TIME
						setInterval(function(){updateTime()},1000);
						function updateTime()
						{
							var date=new Date();
							var seconds=date.getSeconds();
							var minutes=date.getMinutes();
							var hours=date.getHours();
							var time = (hours<10?("0"+hours):hours)+":"+(minutes<10?("0"+minutes):minutes)+":"+(seconds<10?("0"+seconds):seconds)
							document.getElementById("time").innerHTML=time;
						}
        </script>
    </head>
    <body>
        <h1>Paris Metro Viewer</h1>
				<p id="time"></p>
        <div id="canvas"></div>
    </body>
</html>

