<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Paris Metro Viewer</title>
        <script src="raphael-min.js"></script>
        <style media="screen">
            body {
                margin: 0;
                padding: 0;
                text-align: center;
            }
            #canvas {
                text-align: center;
            }
        </style>
				<script>
					var line3color = "#9C9933";
					var yLine = 200;
					var xStartLine = 50;
					var xEndLine = 750;
					var trainLength = 30;
						var paper;
						var background;
						var train;
						var stations = new Array();
						window.onload = function () {
						  paper = Raphael("canvas", "800", "400");
							paper.clear();
							
							background = paper.rect(0, 0, "800", "400", 10).attr({fill: "#ccc", stroke: "none"});
							var line = setLine();
							var LMStation = new Station(paper,xStartLine,yLine,"Louise Michel");
							var PCStation = new Station(paper,(xEndLine+xStartLine)/2,yLine,"Porte de Champeret");
							var PEStation = new Station(paper,xEndLine,yLine,"Pereire");
							train = new Train(paper,xStartLine,yLine);
							updateTrain(train);		
							//TIME
							updateTime();
						};
						//line 
						function setLine(){
							return paper.path("M"+xStartLine+","+yLine+"L"+xEndLine+","+yLine).attr({stroke:line3color,"stroke-width":4});
						}
						//train
						function Train(paper,x,y)
						{
							var width = 20;
							this.drawing = paper.rect(x-trainLength/2,y-width/2,trainLength,width)
							.attr({fill:"black"});
							this.currentStationIndex = 0;
							this.positiveDirection=true;
						}
						setInterval(function(){updateTrain(train)},5000);
						function updateTrain(train)
						{
							var nextStationIndex;
							if(train.positiveDirection){
								nextStationIndex = train.currentStationIndex+1;
							}
							else{
								nextStationIndex = train.currentStationIndex-1;
							}
							if(nextStationIndex>=stations.length||nextStationIndex<0)
							{
								//Change direction
								train.positiveDirection = !train.positiveDirection;
								if(nextStationIndex>=stations.length){
									nextStationIndex = nextStationIndex-2;
								}
								if(nextStationIndex<0){
									nextStationIndex = nextStationIndex+2
								}

							}

							
							var xDestination = stations[nextStationIndex].x;
							var animation = Raphael.animation({x:xDestination-trainLength/2},5000, "<>");
							train.drawing.stop();
							train.drawing.animate(animation);
							if(train.positiveDirection){
								train.currentStationIndex++;
							}
							else{
								train.currentStationIndex--;
							}
						}
						//Station
						function Station(paper,x,y,name)
						{
							this.drawing = paper.circle(x,y,20).attr({stroke:line3color,fill:line3color});
							this.x = x;
							(this.drawing.hover(function(){
								this.drawing.attr({fill:"#fff"});
							},
							function(){
								this.drawing.attr({fill:line3color});
							}));
							//Name of the station
							this.name = name;
							this.nameDrawing = paper.text(x,y-30,name);
							stations.push(this);
						}
						//TIME
						setInterval(function(){updateTime()},1000);
						function updateTime()
						{
							var date=new Date();
							var seconds=date.getSeconds();
							var minutes=date.getMinutes();
							var hours=date.getHours();
							var time = (hours<10?("0"+hours):hours)+":"+(minutes<10?("0"+minutes):minutes)+":"+(seconds<10?("0"+seconds):seconds)
							document.getElementById("time").innerHTML=time;
						}
        </script>
    </head>
    <body>
        <h1>Paris Metro Viewer</h1>
				<p id="time"></p>
        <div id="canvas"></div>
    </body>
</html>

